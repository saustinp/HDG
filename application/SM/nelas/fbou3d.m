function [fb,fb_udg,fb_uh] = fbou3d(ib,uinf,nl,pg,udg,uh,param,time)
%FBOU3D.M
%    [FB,FB_UDG,FB_UH] = FBOU3D(IB,UINF,NL,PG,UDG,UH,PARAM,TIME)
[ng,nc] = size(udg);
nch = 3;
nd = 3;
switch (ib)
    case 1
        one = ones(ng,1);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x2 = pg(:,2);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        fb = [one.*(-uh1+uinf1+x1);-uh2+uinf2+x2;-uh3+uinf3+x3];
        if nargout > 1
            fb_udg = [zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-one;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 2
        [fb,fb_udg,fb_uh] = fhat(nl,pg,udg,uh,param,time);
        fb = fb - uinf;
    case 3
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u2 = udg(:,2);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        zero = zeros(ng,1);
        t2218 = q11.*q32;
        t2239 = q12.*q31;
        t2219 = t2218-t2239;
        t2220 = q11.*q33;
        t2240 = q13.*q31;
        t2221 = t2220-t2240;
        t2222 = q11.*q22.*q33;
        t2223 = q12.*q23.*q31;
        t2224 = q13.*q21.*q32;
        t2229 = q11.*q23.*q32;
        t2230 = q12.*q21.*q33;
        t2231 = q13.*q22.*q31;
        t2225 = -t2230+t2222-t2231+t2223+t2224-t2229;
        t2226 = 1.0./t2225;
        t2227 = q12.*q33;
        t2241 = q13.*q32;
        t2228 = -t2241+t2227;
        t2232 = q11.*q22;
        t2242 = q12.*q21;
        t2233 = t2232-t2242;
        t2234 = q11.*q23;
        t2243 = q13.*q21;
        t2235 = t2234-t2243;
        t2236 = q12.*q23;
        t2244 = q13.*q22;
        t2237 = -t2244+t2236;
        fb = [one.*(-uh1+uinf1+x1);-uinf2+nl1.*(mu.*q21+pres.*t2228+mu.*t2226.*t2228)-nl2.*(-mu.*q22+pres.*t2221+mu.*t2221.*t2226)+nl3.*(mu.*q23+pres.*t2219+mu.*t2226.*t2219)+tau.*(u2-uh2);-uinf3-nl1.*(-mu.*q31+pres.*t2237+mu.*t2226.*t2237)+nl2.*(mu.*q32+pres.*t2235+mu.*t2226.*t2235)-nl3.*(-mu.*q33+pres.*t2233+mu.*t2233.*t2226)+tau.*(u3-uh3)];
        if nargout > 1
            t2238 = one.*tau;
            t2245 = q22.*q33;
            t2248 = q23.*q32;
            t2246 = t2245-t2248;
            t2247 = 1.0./t2225.^2;
            t2249 = pres.*q12;
            t2250 = mu.*q12.*t2226;
            t2251 = pres.*q13;
            t2252 = mu.*q13.*t2226;
            t2253 = pres.*q33;
            t2254 = mu.*q33.*t2226;
            t2255 = q21.*q33;
            t2257 = q23.*q31;
            t2256 = t2255-t2257;
            t2258 = pres.*q23;
            t2259 = mu.*q23.*t2226;
            t2260 = mu.*t2221.*t2237.*t2247;
            t2261 = t2251+t2260+t2252;
            t2262 = pres.*q11;
            t2263 = mu.*q11.*t2226;
            t2264 = t2251+t2252-mu.*t2235.*t2228.*t2247;
            t2265 = pres.*q31;
            t2266 = mu.*q31.*t2226;
            t2267 = pres.*q32;
            t2268 = mu.*q32.*t2226;
            t2269 = q21.*q32;
            t2271 = q22.*q31;
            t2270 = -t2271+t2269;
            t2272 = pres.*q21;
            t2273 = mu.*q21.*t2226;
            t2274 = pres.*q22;
            t2275 = mu.*q22.*t2226;
            t2276 = mu.*t2235.*t2219.*t2247;
            t2277 = t2262+t2263+t2276;
            t2278 = mu.*t2219.*t2237.*t2247;
            t2279 = t2250+t2249+t2278;
            t2280 = t2262+t2263-mu.*t2221.*t2233.*t2247;
            t2281 = t2250+t2249-mu.*t2233.*t2228.*t2247;
            fb_udg = [zero;zero;zero;zero;t2238;zero;zero;zero;t2238;zero;nl1.*t2228-nl2.*t2221+nl3.*t2219;-nl1.*t2237+nl2.*t2235-nl3.*t2233;zero;-nl2.*(t2253+t2254-mu.*t2221.*t2246.*t2247)+nl3.*(t2267+t2268-mu.*t2219.*t2246.*t2247)-mu.*nl1.*t2228.*t2246.*t2247;nl2.*(t2258+t2259-mu.*t2235.*t2246.*t2247)-nl3.*(t2274+t2275-mu.*t2233.*t2246.*t2247)+mu.*nl1.*t2237.*t2246.*t2247;zero;nl1.*(mu+mu.*t2228.^2.*t2247)-mu.*nl2.*t2221.*t2228.*t2247+mu.*nl3.*t2219.*t2228.*t2247;-nl2.*t2264+nl3.*t2281-mu.*nl1.*t2228.*t2237.*t2247;zero;nl2.*t2261-nl3.*t2279-mu.*nl1.*t2228.*t2237.*t2247;nl1.*(mu+mu.*t2237.^2.*t2247)-mu.*nl2.*t2235.*t2237.*t2247+mu.*nl3.*t2233.*t2237.*t2247;zero;nl1.*(t2253+t2254+mu.*t2228.*t2247.*t2256)-nl3.*(t2265+t2266-mu.*t2219.*t2247.*t2256)-mu.*nl2.*t2221.*t2247.*t2256;-nl1.*(t2258+t2259+mu.*t2237.*t2247.*t2256)+nl3.*(t2272+t2273-mu.*t2233.*t2247.*t2256)+mu.*nl2.*t2235.*t2247.*t2256;zero;nl2.*(mu+mu.*t2221.^2.*t2247)-mu.*nl1.*t2221.*t2228.*t2247-mu.*nl3.*t2221.*t2219.*t2247;nl1.*t2261-nl3.*t2280-mu.*nl2.*t2221.*t2235.*t2247;zero;-nl1.*t2264+nl3.*t2277-mu.*nl2.*t2221.*t2235.*t2247;nl2.*(mu+mu.*t2235.^2.*t2247)-mu.*nl1.*t2235.*t2237.*t2247-mu.*nl3.*t2233.*t2235.*t2247;zero;-nl1.*(t2267+t2268+mu.*t2270.*t2228.*t2247)+nl2.*(t2265+t2266+mu.*t2221.*t2270.*t2247)-mu.*nl3.*t2270.*t2219.*t2247;nl1.*(t2274+t2275+mu.*t2270.*t2237.*t2247)-nl2.*(t2272+t2273+mu.*t2270.*t2235.*t2247)+mu.*nl3.*t2233.*t2270.*t2247;zero;nl3.*(mu+mu.*t2219.^2.*t2247)+mu.*nl1.*t2219.*t2228.*t2247-mu.*nl2.*t2221.*t2219.*t2247;-nl1.*t2279+nl2.*t2277-mu.*nl3.*t2233.*t2219.*t2247;zero;nl1.*t2281-nl2.*t2280-mu.*nl3.*t2233.*t2219.*t2247;nl3.*(mu+mu.*t2233.^2.*t2247)+mu.*nl1.*t2233.*t2237.*t2247-mu.*nl2.*t2233.*t2235.*t2247];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-t2238;zero;zero;zero;-t2238];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 4
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u1 = udg(:,1);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x2 = pg(:,2);
        zero = zeros(ng,1);
        t2283 = q21.*q32;
        t2304 = q22.*q31;
        t2284 = t2283-t2304;
        t2285 = q21.*q33;
        t2305 = q23.*q31;
        t2286 = t2285-t2305;
        t2287 = q11.*q22.*q33;
        t2288 = q12.*q23.*q31;
        t2289 = q13.*q21.*q32;
        t2294 = q11.*q23.*q32;
        t2295 = q12.*q21.*q33;
        t2296 = q13.*q22.*q31;
        t2290 = -t2294-t2295+t2287-t2296+t2288+t2289;
        t2291 = 1.0./t2290;
        t2292 = q22.*q33;
        t2306 = q23.*q32;
        t2293 = t2292-t2306;
        t2297 = q11.*q22;
        t2307 = q12.*q21;
        t2298 = t2297-t2307;
        t2299 = q11.*q23;
        t2308 = q13.*q21;
        t2300 = t2299-t2308;
        t2301 = q12.*q23;
        t2309 = q13.*q22;
        t2302 = t2301-t2309;
        fb = [-uinf1-nl1.*(-mu.*q11+pres.*t2293+mu.*t2291.*t2293)+nl2.*(mu.*q12+pres.*t2286+mu.*t2291.*t2286)-nl3.*(-mu.*q13+pres.*t2284+mu.*t2291.*t2284)+tau.*(u1-uh1);-uh2+uinf2+x2;-uinf3-nl1.*(-mu.*q31+pres.*t2302+mu.*t2291.*t2302)+nl2.*(mu.*q32+pres.*t2300+mu.*t2291.*t2300)-nl3.*(-mu.*q33+pres.*t2298+mu.*t2291.*t2298)+tau.*(u3-uh3)];
        if nargout > 1
            t2303 = one.*tau;
            t2310 = 1.0./t2290.^2;
            t2311 = q12.*q33;
            t2313 = q13.*q32;
            t2312 = t2311-t2313;
            t2314 = pres.*q22;
            t2315 = mu.*q22.*t2291;
            t2316 = pres.*q23;
            t2317 = mu.*q23.*t2291;
            t2318 = mu.*nl1.*t2293.*t2310.*t2302;
            t2319 = mu.*t2286.*t2310.*t2302;
            t2320 = t2316+t2317+t2319;
            t2321 = pres.*q33;
            t2322 = mu.*q33.*t2291;
            t2323 = q11.*q33;
            t2325 = q13.*q31;
            t2324 = t2323-t2325;
            t2326 = pres.*q13;
            t2327 = mu.*q13.*t2291;
            t2328 = pres.*q21;
            t2329 = mu.*q21.*t2291;
            t2330 = t2316+t2317-mu.*t2293.*t2300.*t2310;
            t2331 = mu.*nl2.*t2286.*t2300.*t2310;
            t2332 = mu.*t2284.*t2300.*t2310;
            t2333 = t2332+t2328+t2329;
            t2334 = mu.*t2284.*t2310.*t2302;
            t2335 = t2314+t2315+t2334;
            t2336 = pres.*q31;
            t2337 = mu.*q31.*t2291;
            t2338 = pres.*q32;
            t2339 = mu.*q32.*t2291;
            t2340 = q11.*q32;
            t2342 = q12.*q31;
            t2341 = t2340-t2342;
            t2343 = pres.*q11;
            t2344 = mu.*q11.*t2291;
            t2345 = pres.*q12;
            t2346 = mu.*q12.*t2291;
            t2347 = t2328+t2329-mu.*t2286.*t2298.*t2310;
            t2348 = t2314+t2315-mu.*t2293.*t2298.*t2310;
            t2349 = mu.*nl3.*t2284.*t2298.*t2310;
            fb_udg = [t2303;zero;zero;zero;zero;zero;zero;zero;t2303;-nl1.*t2293+nl2.*t2286-nl3.*t2284;zero;-nl1.*t2302+nl2.*t2300-nl3.*t2298;nl1.*(mu+mu.*t2293.^2.*t2310)-mu.*nl2.*t2293.*t2286.*t2310+mu.*nl3.*t2284.*t2293.*t2310;zero;t2318+nl2.*t2330-nl3.*t2348;nl2.*(t2321+t2322+mu.*t2286.*t2310.*t2312)-nl3.*(t2338+t2339+mu.*t2284.*t2310.*t2312)-mu.*nl1.*t2293.*t2310.*t2312;zero;-nl2.*(t2326+t2327-mu.*t2300.*t2310.*t2312)+nl3.*(t2345+t2346-mu.*t2298.*t2310.*t2312)-mu.*nl1.*t2310.*t2302.*t2312;t2318-nl2.*t2320+nl3.*t2335;zero;nl1.*(mu+mu.*t2310.*t2302.^2)-mu.*nl2.*t2300.*t2310.*t2302+mu.*nl3.*t2298.*t2310.*t2302;nl2.*(mu+mu.*t2286.^2.*t2310)-mu.*nl1.*t2293.*t2286.*t2310-mu.*nl3.*t2284.*t2286.*t2310;zero;t2331-nl1.*t2320+nl3.*t2347;-nl1.*(t2321+t2322-mu.*t2293.*t2310.*t2324)+nl3.*(t2336+t2337+mu.*t2284.*t2310.*t2324)-mu.*nl2.*t2286.*t2310.*t2324;zero;nl1.*(t2326+t2327+mu.*t2310.*t2302.*t2324)-nl3.*(t2343+t2344-mu.*t2298.*t2310.*t2324)-mu.*nl2.*t2300.*t2310.*t2324;t2331+nl1.*t2330-nl3.*t2333;zero;nl2.*(mu+mu.*t2300.^2.*t2310)-mu.*nl1.*t2300.*t2310.*t2302-mu.*nl3.*t2298.*t2300.*t2310;nl3.*(mu+mu.*t2284.^2.*t2310)+mu.*nl1.*t2284.*t2293.*t2310-mu.*nl2.*t2284.*t2286.*t2310;zero;t2349+nl1.*t2335-nl2.*t2333;nl1.*(t2338+t2339-mu.*t2293.*t2310.*t2341)-nl2.*(t2336+t2337-mu.*t2286.*t2310.*t2341)-mu.*nl3.*t2284.*t2310.*t2341;zero;-nl1.*(t2345+t2346+mu.*t2310.*t2302.*t2341)+nl2.*(t2343+t2344+mu.*t2300.*t2310.*t2341)-mu.*nl3.*t2298.*t2310.*t2341;t2349-nl1.*t2348+nl2.*t2347;zero;nl3.*(mu+mu.*t2298.^2.*t2310)+mu.*nl1.*t2298.*t2310.*t2302-mu.*nl2.*t2298.*t2300.*t2310];
        end
        if nargout > 2
            fb_uh = [-t2303;zero;zero;zero;-one;zero;zero;zero;-t2303];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 5
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u1 = udg(:,1);
        u2 = udg(:,2);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2351 = q21.*q32;
        t2372 = q22.*q31;
        t2352 = t2351-t2372;
        t2353 = q21.*q33;
        t2373 = q23.*q31;
        t2354 = t2353-t2373;
        t2355 = q11.*q22.*q33;
        t2356 = q12.*q23.*q31;
        t2357 = q13.*q21.*q32;
        t2362 = q11.*q23.*q32;
        t2363 = q12.*q21.*q33;
        t2364 = q13.*q22.*q31;
        t2358 = -t2362-t2363+t2355-t2364+t2356+t2357;
        t2359 = 1.0./t2358;
        t2360 = q22.*q33;
        t2374 = q23.*q32;
        t2361 = t2360-t2374;
        t2365 = q11.*q32;
        t2375 = q12.*q31;
        t2366 = t2365-t2375;
        t2367 = q11.*q33;
        t2376 = q13.*q31;
        t2368 = t2367-t2376;
        t2369 = q12.*q33;
        t2377 = q13.*q32;
        t2370 = -t2377+t2369;
        fb = [-uinf1-nl1.*(-mu.*q11+pres.*t2361+mu.*t2361.*t2359)+nl2.*(mu.*q12+pres.*t2354+mu.*t2354.*t2359)-nl3.*(-mu.*q13+pres.*t2352+mu.*t2352.*t2359)+tau.*(u1-uh1);-uinf2+nl1.*(mu.*q21+pres.*t2370+mu.*t2370.*t2359)-nl2.*(-mu.*q22+pres.*t2368+mu.*t2359.*t2368)+nl3.*(mu.*q23+pres.*t2366+mu.*t2366.*t2359)+tau.*(u2-uh2);-uh3+uinf3+x3];
        if nargout > 1
            t2371 = one.*tau;
            t2378 = 1.0./t2358.^2;
            t2379 = pres.*q32;
            t2380 = mu.*q32.*t2359;
            t2381 = pres.*q33;
            t2382 = mu.*q33.*t2359;
            t2383 = q12.*q23;
            t2385 = q13.*q22;
            t2384 = t2383-t2385;
            t2386 = mu.*t2370.*t2354.*t2378;
            t2387 = t2381+t2382+t2386;
            t2388 = pres.*q31;
            t2389 = mu.*q31.*t2359;
            t2390 = t2381+t2382-mu.*t2361.*t2368.*t2378;
            t2391 = pres.*q23;
            t2392 = mu.*q23.*t2359;
            t2393 = q11.*q23;
            t2395 = q13.*q21;
            t2394 = t2393-t2395;
            t2396 = pres.*q13;
            t2397 = mu.*q13.*t2359;
            t2398 = mu.*t2352.*t2368.*t2378;
            t2399 = t2388+t2389+t2398;
            t2400 = mu.*t2352.*t2370.*t2378;
            t2401 = t2380+t2379+t2400;
            t2402 = t2388+t2389-mu.*t2354.*t2366.*t2378;
            t2403 = t2380+t2379-mu.*t2361.*t2366.*t2378;
            t2404 = pres.*q21;
            t2405 = mu.*q21.*t2359;
            t2406 = pres.*q22;
            t2407 = mu.*q22.*t2359;
            t2408 = q11.*q22;
            t2410 = q12.*q21;
            t2409 = -t2410+t2408;
            t2411 = pres.*q11;
            t2412 = mu.*q11.*t2359;
            t2413 = pres.*q12;
            t2414 = mu.*q12.*t2359;
            fb_udg = [t2371;zero;zero;zero;t2371;zero;zero;zero;zero;-nl1.*t2361+nl2.*t2354-nl3.*t2352;nl1.*t2370-nl2.*t2368+nl3.*t2366;zero;nl1.*(mu+mu.*t2361.^2.*t2378)-mu.*nl2.*t2361.*t2354.*t2378+mu.*nl3.*t2352.*t2361.*t2378;-nl2.*t2390+nl3.*t2403-mu.*nl1.*t2361.*t2370.*t2378;zero;nl2.*t2387-nl3.*t2401-mu.*nl1.*t2361.*t2370.*t2378;nl1.*(mu+mu.*t2370.^2.*t2378)-mu.*nl2.*t2370.*t2368.*t2378+mu.*nl3.*t2370.*t2366.*t2378;zero;-nl2.*(t2391+t2392+mu.*t2354.*t2384.*t2378)+nl3.*(t2406+t2407+mu.*t2352.*t2384.*t2378)+mu.*nl1.*t2361.*t2384.*t2378;nl2.*(t2396+t2397+mu.*t2384.*t2368.*t2378)-nl3.*(t2413+t2414+mu.*t2366.*t2384.*t2378)-mu.*nl1.*t2370.*t2384.*t2378;zero;nl2.*(mu+mu.*t2354.^2.*t2378)-mu.*nl1.*t2361.*t2354.*t2378-mu.*nl3.*t2352.*t2354.*t2378;nl1.*t2387-nl3.*t2402-mu.*nl2.*t2354.*t2368.*t2378;zero;-nl1.*t2390+nl3.*t2399-mu.*nl2.*t2354.*t2368.*t2378;nl2.*(mu+mu.*t2368.^2.*t2378)-mu.*nl1.*t2370.*t2368.*t2378-mu.*nl3.*t2366.*t2368.*t2378;zero;nl1.*(t2391+t2392-mu.*t2361.*t2394.*t2378)-nl3.*(t2404+t2405+mu.*t2352.*t2394.*t2378)+mu.*nl2.*t2354.*t2394.*t2378;-nl1.*(t2396+t2397-mu.*t2370.*t2394.*t2378)+nl3.*(t2411+t2412+mu.*t2366.*t2394.*t2378)-mu.*nl2.*t2394.*t2368.*t2378;zero;nl3.*(mu+mu.*t2352.^2.*t2378)+mu.*nl1.*t2352.*t2361.*t2378-mu.*nl2.*t2352.*t2354.*t2378;-nl1.*t2401+nl2.*t2399-mu.*nl3.*t2352.*t2366.*t2378;zero;nl1.*t2403-nl2.*t2402-mu.*nl3.*t2352.*t2366.*t2378;nl3.*(mu+mu.*t2366.^2.*t2378)+mu.*nl1.*t2370.*t2366.*t2378-mu.*nl2.*t2366.*t2368.*t2378;zero;-nl1.*(t2406+t2407-mu.*t2361.*t2378.*t2409)+nl2.*(t2404+t2405-mu.*t2354.*t2378.*t2409)+mu.*nl3.*t2352.*t2378.*t2409;nl1.*(t2413+t2414-mu.*t2370.*t2378.*t2409)-nl2.*(t2411+t2412-mu.*t2368.*t2378.*t2409)-mu.*nl3.*t2366.*t2378.*t2409;zero];
        end
        if nargout > 2
            fb_uh = [-t2371;zero;zero;zero;-t2371;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 6
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x2 = pg(:,2);
        zero = zeros(ng,1);
        t2416 = q11.*q22;
        t2430 = q12.*q21;
        t2417 = -t2430+t2416;
        t2418 = q11.*q23;
        t2431 = q13.*q21;
        t2419 = -t2431+t2418;
        t2420 = q11.*q22.*q33;
        t2421 = q12.*q23.*q31;
        t2422 = q13.*q21.*q32;
        t2427 = q11.*q23.*q32;
        t2428 = q12.*q21.*q33;
        t2429 = q13.*q22.*q31;
        t2423 = t2420+t2421+t2422-t2427-t2428-t2429;
        t2424 = 1.0./t2423;
        t2425 = q12.*q23;
        t2432 = q13.*q22;
        t2426 = -t2432+t2425;
        fb = [one.*(-uh1+uinf1+x1);-uh2+uinf2+x2;-uinf3-nl1.*(-mu.*q31+pres.*t2426+mu.*t2424.*t2426)+nl2.*(mu.*q32+pres.*t2419+mu.*t2424.*t2419)-nl3.*(-mu.*q33+pres.*t2417+mu.*t2424.*t2417)+tau.*(u3-uh3)];
        if nargout > 1
            t2433 = q22.*q33;
            t2436 = q23.*q32;
            t2434 = t2433-t2436;
            t2435 = 1.0./t2423.^2;
            t2437 = q12.*q33;
            t2439 = q13.*q32;
            t2438 = t2437-t2439;
            t2440 = pres.*q23;
            t2441 = mu.*q23.*t2424;
            t2442 = q21.*q33;
            t2444 = q23.*q31;
            t2443 = t2442-t2444;
            t2445 = pres.*q13;
            t2446 = mu.*q13.*t2424;
            t2447 = q11.*q33;
            t2449 = q13.*q31;
            t2448 = t2447-t2449;
            t2450 = pres.*q21;
            t2451 = mu.*q21.*t2424;
            t2452 = pres.*q22;
            t2453 = mu.*q22.*t2424;
            t2454 = q21.*q32;
            t2456 = q22.*q31;
            t2455 = t2454-t2456;
            t2457 = pres.*q11;
            t2458 = mu.*q11.*t2424;
            t2459 = pres.*q12;
            t2460 = mu.*q12.*t2424;
            t2461 = q11.*q32;
            t2463 = q12.*q31;
            t2462 = t2461-t2463;
            t2464 = one.*tau;
            fb_udg = [zero;zero;zero;zero;zero;zero;zero;zero;t2464;zero;zero;-nl1.*t2426+nl2.*t2419-nl3.*t2417;zero;zero;nl2.*(t2440+t2441-mu.*t2434.*t2435.*t2419)-nl3.*(t2452+t2453-mu.*t2434.*t2417.*t2435)+mu.*nl1.*t2434.*t2426.*t2435;zero;zero;-nl2.*(t2445+t2446-mu.*t2435.*t2419.*t2438)+nl3.*(t2460+t2459-mu.*t2417.*t2435.*t2438)-mu.*nl1.*t2426.*t2435.*t2438;zero;zero;nl1.*(mu+mu.*t2426.^2.*t2435)-mu.*nl2.*t2426.*t2435.*t2419+mu.*nl3.*t2417.*t2426.*t2435;zero;zero;-nl1.*(t2440+t2441+mu.*t2443.*t2426.*t2435)+nl3.*(t2450+t2451-mu.*t2443.*t2417.*t2435)+mu.*nl2.*t2443.*t2435.*t2419;zero;zero;nl1.*(t2445+t2446+mu.*t2426.*t2435.*t2448)-nl3.*(t2457+t2458-mu.*t2417.*t2435.*t2448)-mu.*nl2.*t2435.*t2419.*t2448;zero;zero;nl2.*(mu+mu.*t2435.*t2419.^2)-mu.*nl1.*t2426.*t2435.*t2419-mu.*nl3.*t2417.*t2435.*t2419;zero;zero;nl1.*(t2452+t2453+mu.*t2426.*t2435.*t2455)-nl2.*(t2450+t2451+mu.*t2435.*t2419.*t2455)+mu.*nl3.*t2417.*t2435.*t2455;zero;zero;-nl1.*(t2460+t2459+mu.*t2426.*t2435.*t2462)+nl2.*(t2457+t2458+mu.*t2435.*t2462.*t2419)-mu.*nl3.*t2417.*t2435.*t2462;zero;zero;nl3.*(mu+mu.*t2417.^2.*t2435)+mu.*nl1.*t2417.*t2426.*t2435-mu.*nl2.*t2417.*t2435.*t2419];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-one;zero;zero;zero;-t2464];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 7
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u1 = udg(:,1);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x2 = pg(:,2);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2466 = q21.*q32;
        t2480 = q22.*q31;
        t2467 = -t2480+t2466;
        t2468 = q21.*q33;
        t2481 = q23.*q31;
        t2469 = -t2481+t2468;
        t2470 = q11.*q22.*q33;
        t2471 = q12.*q23.*q31;
        t2472 = q13.*q21.*q32;
        t2477 = q11.*q23.*q32;
        t2478 = q12.*q21.*q33;
        t2479 = q13.*q22.*q31;
        t2473 = t2470+t2471+t2472-t2477-t2478-t2479;
        t2474 = 1.0./t2473;
        t2475 = q22.*q33;
        t2482 = q23.*q32;
        t2476 = -t2482+t2475;
        fb = [-uinf1-nl1.*(-mu.*q11+pres.*t2476+mu.*t2474.*t2476)+nl2.*(mu.*q12+pres.*t2469+mu.*t2474.*t2469)-nl3.*(-mu.*q13+pres.*t2467+mu.*t2474.*t2467)+tau.*(u1-uh1);-uh2+uinf2+x2;-uh3+uinf3+x3];
        if nargout > 1
            t2483 = 1.0./t2473.^2;
            t2484 = q12.*q33;
            t2486 = q13.*q32;
            t2485 = t2484-t2486;
            t2487 = q12.*q23;
            t2489 = q13.*q22;
            t2488 = t2487-t2489;
            t2490 = pres.*q33;
            t2491 = mu.*q33.*t2474;
            t2492 = q11.*q33;
            t2494 = q13.*q31;
            t2493 = t2492-t2494;
            t2495 = pres.*q23;
            t2496 = mu.*q23.*t2474;
            t2497 = q11.*q23;
            t2499 = q13.*q21;
            t2498 = t2497-t2499;
            t2500 = pres.*q31;
            t2501 = mu.*q31.*t2474;
            t2502 = pres.*q32;
            t2503 = mu.*q32.*t2474;
            t2504 = q11.*q32;
            t2506 = q12.*q31;
            t2505 = t2504-t2506;
            t2507 = pres.*q21;
            t2508 = mu.*q21.*t2474;
            t2509 = pres.*q22;
            t2510 = mu.*q22.*t2474;
            t2511 = q11.*q22;
            t2513 = q12.*q21;
            t2512 = t2511-t2513;
            t2514 = one.*tau;
            fb_udg = [t2514;zero;zero;zero;zero;zero;zero;zero;zero;-nl1.*t2476+nl2.*t2469-nl3.*t2467;zero;zero;nl1.*(mu+mu.*t2483.*t2476.^2)-mu.*nl2.*t2483.*t2476.*t2469+mu.*nl3.*t2483.*t2467.*t2476;zero;zero;nl2.*(t2490+t2491+mu.*t2483.*t2485.*t2469)-nl3.*(t2502+t2503+mu.*t2483.*t2467.*t2485)-mu.*nl1.*t2483.*t2476.*t2485;zero;zero;-nl2.*(t2495+t2496+mu.*t2483.*t2469.*t2488)+nl3.*(t2510+t2509+mu.*t2483.*t2467.*t2488)+mu.*nl1.*t2483.*t2476.*t2488;zero;zero;nl2.*(mu+mu.*t2483.*t2469.^2)-mu.*nl1.*t2483.*t2476.*t2469-mu.*nl3.*t2483.*t2467.*t2469;zero;zero;-nl1.*(t2490+t2491-mu.*t2483.*t2493.*t2476)+nl3.*(t2500+t2501+mu.*t2483.*t2493.*t2467)-mu.*nl2.*t2483.*t2493.*t2469;zero;zero;nl1.*(t2495+t2496-mu.*t2483.*t2476.*t2498)-nl3.*(t2507+t2508+mu.*t2483.*t2467.*t2498)+mu.*nl2.*t2483.*t2469.*t2498;zero;zero;nl3.*(mu+mu.*t2483.*t2467.^2)+mu.*nl1.*t2483.*t2467.*t2476-mu.*nl2.*t2483.*t2467.*t2469;zero;zero;nl1.*(t2502+t2503-mu.*t2483.*t2476.*t2505)-nl2.*(t2500+t2501-mu.*t2483.*t2469.*t2505)-mu.*nl3.*t2483.*t2467.*t2505;zero;zero;-nl1.*(t2510+t2509-mu.*t2483.*t2476.*t2512)+nl2.*(t2507+t2508-mu.*t2483.*t2469.*t2512)+mu.*nl3.*t2483.*t2467.*t2512;zero;zero];
        end
        if nargout > 2
            fb_uh = [-t2514;zero;zero;zero;-one;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 8
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u2 = udg(:,2);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2516 = q11.*q32;
        t2530 = q12.*q31;
        t2517 = -t2530+t2516;
        t2518 = q11.*q33;
        t2531 = q13.*q31;
        t2519 = -t2531+t2518;
        t2520 = q11.*q22.*q33;
        t2521 = q12.*q23.*q31;
        t2522 = q13.*q21.*q32;
        t2527 = q11.*q23.*q32;
        t2528 = q12.*q21.*q33;
        t2529 = q13.*q22.*q31;
        t2523 = t2520+t2521+t2522-t2527-t2528-t2529;
        t2524 = 1.0./t2523;
        t2525 = q12.*q33;
        t2532 = q13.*q32;
        t2526 = -t2532+t2525;
        fb = [one.*(-uh1+uinf1+x1);-uinf2+nl1.*(mu.*q21+pres.*t2526+mu.*t2524.*t2526)-nl2.*(-mu.*q22+pres.*t2519+mu.*t2524.*t2519)+nl3.*(mu.*q23+pres.*t2517+mu.*t2524.*t2517)+tau.*(u2-uh2);-uh3+uinf3+x3];
        if nargout > 1
            t2533 = q22.*q33;
            t2536 = q23.*q32;
            t2534 = t2533-t2536;
            t2535 = 1.0./t2523.^2;
            t2537 = q12.*q23;
            t2539 = q13.*q22;
            t2538 = t2537-t2539;
            t2540 = pres.*q33;
            t2541 = mu.*q33.*t2524;
            t2542 = q21.*q33;
            t2544 = q23.*q31;
            t2543 = t2542-t2544;
            t2545 = pres.*q13;
            t2546 = mu.*q13.*t2524;
            t2547 = q11.*q23;
            t2549 = q13.*q21;
            t2548 = t2547-t2549;
            t2550 = pres.*q31;
            t2551 = mu.*q31.*t2524;
            t2552 = pres.*q32;
            t2553 = mu.*q32.*t2524;
            t2554 = q21.*q32;
            t2556 = q22.*q31;
            t2555 = t2554-t2556;
            t2557 = pres.*q11;
            t2558 = mu.*q11.*t2524;
            t2559 = pres.*q12;
            t2560 = mu.*q12.*t2524;
            t2561 = q11.*q22;
            t2563 = q12.*q21;
            t2562 = t2561-t2563;
            t2564 = one.*tau;
            fb_udg = [zero;zero;zero;zero;t2564;zero;zero;zero;zero;zero;nl1.*t2526-nl2.*t2519+nl3.*t2517;zero;zero;-nl2.*(t2540+t2541-mu.*t2534.*t2535.*t2519)+nl3.*(t2552+t2553-mu.*t2534.*t2517.*t2535)-mu.*nl1.*t2534.*t2526.*t2535;zero;zero;nl1.*(mu+mu.*t2526.^2.*t2535)-mu.*nl2.*t2526.*t2535.*t2519+mu.*nl3.*t2517.*t2526.*t2535;zero;zero;nl2.*(t2545+t2546+mu.*t2535.*t2519.*t2538)-nl3.*(t2560+t2559+mu.*t2517.*t2535.*t2538)-mu.*nl1.*t2526.*t2535.*t2538;zero;zero;nl1.*(t2540+t2541+mu.*t2543.*t2526.*t2535)-nl3.*(t2550+t2551-mu.*t2543.*t2517.*t2535)-mu.*nl2.*t2543.*t2535.*t2519;zero;zero;nl2.*(mu+mu.*t2535.*t2519.^2)-mu.*nl1.*t2526.*t2535.*t2519-mu.*nl3.*t2517.*t2535.*t2519;zero;zero;-nl1.*(t2545+t2546-mu.*t2526.*t2535.*t2548)+nl3.*(t2557+t2558+mu.*t2517.*t2535.*t2548)-mu.*nl2.*t2535.*t2519.*t2548;zero;zero;-nl1.*(t2552+t2553+mu.*t2526.*t2535.*t2555)+nl2.*(t2550+t2551+mu.*t2535.*t2519.*t2555)-mu.*nl3.*t2517.*t2535.*t2555;zero;zero;nl3.*(mu+mu.*t2517.^2.*t2535)+mu.*nl1.*t2517.*t2526.*t2535-mu.*nl2.*t2517.*t2535.*t2519;zero;zero;nl1.*(t2560+t2559-mu.*t2526.*t2535.*t2562)-nl2.*(t2557+t2558-mu.*t2535.*t2562.*t2519)-mu.*nl3.*t2517.*t2535.*t2562;zero];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-t2564;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    otherwise
         error('unknown boundary type');
end
